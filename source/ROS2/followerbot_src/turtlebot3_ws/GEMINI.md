# 팔로워 로봇 리팩토링 계획

## 문제 상황

리더 로봇이 회전할 때 팔로워 로봇이 대형을 유지하지 못하고 제자리에서 회전만 하는 문제가 발생함. 이는 부정확한 TF 정보 및 컨트롤러 설정 문제 등이 복합적으로 작용한 결과로 추정됨.

## 해결 방안: 리더의 신호를 이용한 명시적인 상태 관리

복잡한 자가 진단 로직 대신, 리더 로봇이 자신의 상태를 명시적으로 알려주는 신호를 보내고 팔로워는 그 신호에 따라 동작을 결정하는 방식으로 문제를 해결한다.

### 시스템 구성

1.  **리더 로봇:**
    -   회전을 시작하기 직전에 팔로워에게 "회전 시작" 신호를 보낸다.
    -   회전을 완료한 직후에 팔로워에게 "회전 종료" 신호를 보낸다.
    -   신호는 ROS 서비스(`std_srvs::srv::Trigger`)를 통해 전달된다.

2.  **팔로워 로봇:**
    -   "회전 시작" 및 "회전 종료" 신호를 수신할 두 개의 서비스 서버를 구현한다.
    -   내부적으로 `is_paused` 와 같은 상태 변수를 두어 리더의 회전 여부를 관리한다.

### 동작 시나리오

1.  **평시 주행 (`is_paused = false`):**
    -   팔로워는 기존의 목표 지점 계산 로직에 따라 리더와의 `(d, d)` 대각선 대형을 유지하며 주행한다.

2.  **리더 "회전 시작" 신호 수신:**
    -   팔로워의 `handle_turn_start` 서비스 콜백이 호출된다.
    -   `is_paused` 상태를 `true`로 변경한다.
    -   `nav2`의 모든 목표를 취소하고, 정지(`속도 0`) 명령을 보내 제자리에 멈춘다.
    -   `send_path` 함수는 `is_paused`가 `true`이므로 더 이상 새로운 경로를 전송하지 않는다.

3.  **리더 "회전 종료" 신호 수신:**
    -   팔로워의 `handle_turn_end` 서비스 콜백이 호출된다.
    -   `is_paused` 상태를 `false`로 변경한다.

4.  **주행 재개 및 재정렬:**
    -   `send_path` 함수가 다시 동작을 시작한다.
    -   회전을 마친 리더의 새로운 위치와 방향을 기준으로, 팔로워가 있어야 할 새로운 목표 지점을 계산한다.
    -   `nav2`는 이 새로운 목표 지점으로 이동하라는 경로를 받고, 대형을 맞추기 위한 재정렬 주행을 시작한다.

이 방식은 리더와 팔로워의 역할과 책임이 명확하게 분리되어, 예측 가능하고 안정적인 대형 유지 동작을 보장한다.
